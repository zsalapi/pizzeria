<?php
session_start();
header('Content-Type: application/json');
require_once '../db/config.php';

if ($_SERVER["REQUEST_METHOD"] === "POST") {
    $name = $_POST["name"] ?? '';
    $password = $_POST["password"] ?? '';
    $hash = hash("sha256", $password);

    $stmt = $pdo->prepare("SELECT * FROM users WHERE name = :name AND role = 'admin'");
    $stmt->execute(['name' => $name]);
    $user = $stmt->fetch();

    if ($user && hash_equals($user['password'], $hash)) {
        $_SESSION["admin_logged_in"] = true;
        $_SESSION["admin_name"] = $name;
        echo json_encode(["success" => true]);
    } else {
        echo json_encode(["success" => false, "message" => "Hibás felhasználónév vagy jelszó."]);
    }
} else {
    echo json_encode(["success" => false, "message" => "Érvénytelen kérés."]);
}
